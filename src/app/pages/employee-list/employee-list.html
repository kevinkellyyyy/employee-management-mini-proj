<div class="container mx-auto px-4 py-8">
  <div class="bg-white rounded-lg shadow-lg p-6">
    <div
      class="flex flex-col md:flex-row justify-between items-center mb-4 gap-2"
    >
      <h1 class="text-lg md:text-2xl font-bold text-gray-800 text-center">
        Daftar Karyawan
      </h1>
      <button
        routerLink="/new-employee"
        class="text-xs md:text- flex items-center gap-2 bg-main-blue hover:bg-secondary-blue text-white px-4 py-2 rounded-md font-medium"
      >
        Tambah Karyawan Baru
        <app-add-icon />
      </button>
    </div>

    <div
      class="flex flex-col md:flex-row items-center justify-between mb-4 gap-2"
    >
      <div class="flex flex-col md:flex-row items-center">
        <select
          [(ngModel)]="searchBy"
          class="border px-2 py-2 rounded w-full md:w-auto"
        >
          <option value="username">Username</option>
          <option value="fullName">Nama</option>
          <option value="email">Email</option>
          <option value="birthDate">Tanggal Lahir</option>
          <option value="basicSalary">Gaji Pokok</option>
          <option value="status">Status</option>
          <option value="jobGroup">Grup Pekerjaan</option>
        </select>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          placeholder="Cari..."
          class="border px-2 py-2 rounded"
        />
      </div>

      <div class="flex flex-col md:flex-row items-center gap-2">
        @if (showFilter()) {
        <div class="flex flex-col md:flex-row items-center gap-2">
          <select
            [(ngModel)]="sortBy"
            (change)="onSortOrFilterChange()"
            class="border px-2 py-2 rounded w-full"
          >
            <option value="">Urut Berdasarkan</option>
            <option value="name">Nama</option>
            <option value="salary">Gaji</option>
            <option value="birthYear">Tahun Lahir</option>
          </select>
          <select
            [(ngModel)]="filterJobGroup"
            (change)="onSortOrFilterChange()"
            class="border px-2 py-2 rounded"
          >
            <option value="">Filter Grup Pekerjaan</option>
            @for (group of jobGroups(); track group) {
            <option [value]="group">
              {{ group }}
            </option>
            }
          </select>
        </div>
        }

        <button
          (click)="toggleFilter()"
          class="bg-red-100 hover:bg-red-50 px-4 py-2 rounded"
        >
          @if (!showFilter()) {
          <div class="flex items-center gap-2">
            <p class="text-red-500 text-sm">Filter</p>
            <app-filter-icon />
          </div>
          } @else {
          <app-close-icon />
          }
        </button>
      </div>
    </div>

    <div class="flex overflow-auto">
      <table mat-table [dataSource]="dataSource">
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef>Username</th>
          <td mat-cell *matCellDef="let emp" class="text-[10px] md:text-[14px]">
            {{ emp.username }}
          </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Nama</th>
          <td mat-cell *matCellDef="let emp" class="text-[10px] md:text-[14px]">
            {{ emp.firstName }} {{ emp.lastName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let emp" class="text-[10px] md:text-[14px]">
            {{ emp.email }}
          </td>
        </ng-container>

        <ng-container matColumnDef="birthDate">
          <th mat-header-cell *matHeaderCellDef>Tanggal Lahir</th>
          <td mat-cell *matCellDef="let emp" class="text-[10px] md:text-[14px]">
            {{ emp.birthDate | birthdateId }}
          </td>
        </ng-container>

        <ng-container matColumnDef="basicSalary">
          <th mat-header-cell *matHeaderCellDef>Gaji Pokok</th>
          <td mat-cell *matCellDef="let emp" class="text-[10px] md:text-[14px]">
            {{ emp.basicSalary | currencyId }}
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let emp" class="text-[10px] md:text-[14px]">
            {{ emp.status }}
          </td>
        </ng-container>

        <ng-container matColumnDef="jobGroup">
          <th mat-header-cell *matHeaderCellDef>Grup Pekerjaan</th>
          <td mat-cell *matCellDef="let emp" class="text-[10px] md:text-[14px]">
            {{ emp.group }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions" stickyEnd>
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let emp">
            <div class="flex space-x-2">
              <button
                (click)="openDialogEdit(emp); $event.stopPropagation()"
                class="bg-main-yellow hover:bg-secondary-yellow p-1 rounded text-xs"
              >
                <app-edit-icon />
              </button>
              <button
                (click)="openDialogDelete(emp); $event.stopPropagation()"
                class="bg-red-500 hover:bg-red-700 p-1 rounded text-xs"
              >
                <app-delete-icon />
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
        <tr
          class="cursor-pointer hover:bg-gray-100"
          mat-row
          *matRowDef="let row; columns: displayedColumns()"
          (click)="handleRowClick(row)"
        ></tr>
      </table>
    </div>

    <mat-paginator
      [pageSizeOptions]="[10, 20, 50, 100]"
      [showFirstLastButtons]="isLargeScreen()"
      aria-label="Select page of periodic elements"
    >
    </mat-paginator>
  </div>
</div>
